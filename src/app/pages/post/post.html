@if (post(); as post) {
  <div class="post-mobile-topbar" role="toolbar" aria-label="Post quick actions">
    <div class="mobile-topbar-group">
      <a class="mobile-topbar-btn" routerLink="/blog" aria-label="Back to home" title="Back to home">
        <i class="ph ph-house" aria-hidden="true"></i>
      </a>
      @if (tocItems().length) {
        <button
          class="mobile-topbar-btn"
          type="button"
          (click)="toggleToc()"
          [attr.aria-expanded]="tocOpen()"
          aria-controls="post-toc"
          aria-label="Toggle table of contents"
          title="Table of Contents"
        >
          @if (tocOpen()) {
            <i class="ph ph-x" aria-hidden="true"></i>
          } @else {
            <i class="ph ph-list" aria-hidden="true"></i>
          }
        </button>
      }
    </div>

    <div class="mobile-topbar-title">Reading</div>

    <div class="mobile-topbar-group">
      <button class="mobile-topbar-btn" type="button" (click)="openMobileSearch()" aria-label="Search" title="Search">
        <i class="ph ph-magnifying-glass" aria-hidden="true"></i>
      </button>
      <button class="mobile-topbar-btn" type="button" (click)="printPage()" aria-label="Print" title="Print">
        <i class="ph ph-printer" aria-hidden="true"></i>
      </button>
      <button class="mobile-topbar-btn" type="button" (click)="toggleTheme()" aria-label="Toggle theme" title="Toggle theme">
        @if (isDark()) {
          <i class="ph ph-sun" aria-hidden="true"></i>
        } @else {
          <i class="ph ph-moon" aria-hidden="true"></i>
        }
      </button>
    </div>
  </div>

  <a class="home-btn" routerLink="/blog" aria-label="Back to home" title="Back to home">
    <i class="ph ph-house" aria-hidden="true" style="font-size: 20px"></i>
  </a>

  @if (tocItems().length) {
    <button
      class="toc-toggle"
      type="button"
      (click)="toggleToc()"
      [attr.aria-expanded]="tocOpen()"
      aria-controls="post-toc"
      aria-label="Toggle table of contents"
      title="Table of Contents"
    >
      @if (tocOpen()) {
        <i class="ph ph-x" aria-hidden="true" style="font-size: 20px"></i>
      } @else {
        <i class="ph ph-list" aria-hidden="true" style="font-size: 20px"></i>
      }
    </button>

    <nav
      class="post-toc"
      [class.toc-visible]="tocOpen()"
      id="post-toc"
      aria-label="Table of contents"
      (keydown.escape)="closeToc()"
      tabindex="-1"
    >
      <div class="toc-title">
        <i class="ph ph-list-numbers toc-title-icon" aria-hidden="true"></i>
        <span>Contents</span>
      </div>
      <div class="toc-nav">
        @for (item of tocItems(); track item.id) {
          <a
            class="toc-link"
            [class.level-3]="item.level === 3"
            [class.is-active]="activeHeadingId() === item.id"
            [href]="'#' + item.id"
            (click)="onTocClick($event, item.id)"
          >
            <span class="toc-link-icon" aria-hidden="true">
              @if (item.level === 2) {
                <i class="ph ph-bookmark-simple"></i>
              } @else {
                <i class="ph ph-caret-right"></i>
              }
            </span>
            <span class="toc-link-text">{{ item.text }}</span>
          </a>
        }
      </div>
    </nav>

    <div
      class="toc-backdrop"
      [class.toc-backdrop-visible]="tocOpen() && !isWide()"
      (click)="closeToc()"
      tabindex="-1"
      role="button"
      aria-label="Close table of contents"
    ></div>
  }

  <app-post-header [title]="post.title" [date]="post.date" [coverImage]="post.coverImage" />

  <article class="post-body" [innerHTML]="safeHtml()"></article>

  <section class="giscus-wrapper">
    <div class="giscus"></div>
  </section>

  @if (mobileSearchOpen()) {
    <app-search-modal (closed)="mobileSearchOpen.set(false)" />
  }

  <button
    class="back-to-top"
    type="button"
    [class.is-visible]="showBackToTop()"
    (click)="scrollToTop()"
    aria-label="Back to top"
    title="Back to top"
  >
    <i class="ph ph-arrow-line-up" aria-hidden="true" style="font-size: 20px"></i>
  </button>
} @else {
  <div class="not-found">
    <h1>Post not found</h1>
    <a routerLink="/blog"><i class="ph ph-arrow-left" aria-hidden="true"></i> Back to all posts</a>
  </div>
}
